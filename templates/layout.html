<!DOCTYPE html>
<html>
<head>
    <title>TK Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .success-icon {
    font-size: 80px;
    color: #28a745;
    animation: pop 0.5s ease;
}

@keyframes pop {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

        .cart-item:not(:last-child) {
    border-bottom: 1px solid #eee;
    padding-bottom: 15px;
    margin-bottom: 15px;
}

        .modern-remove {
    border: none;
    background: transparent;
    color: #dc3545;
    font-size: 16px;
    transition: 0.3s ease;
}

.modern-remove:hover {
    transform: scale(1.2);
    color: #ff4d6d;
}

        body {
            background-color: #f8f9fa;
        }

        .hero {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .card {
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 15px;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

       .btn-acrylic {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white !important;
    border: none;
    border-radius: 50px;
    padding: 10px 20px;
    font-weight: 600;
    transition: 0.3s ease;
}

.btn-acrylic:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102,126,234,0.4);
    color: white !important;
}


        footer {
            background: #111;
            color: white;
            padding: 30px 0;
            margin-top: 60px;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">TK Shop</a>
        <div>
            <button onclick="openCart()" class="btn btn-acrylic position-relative">
    Cart
    {% if cart_count > 0 %}
    <span class="position-absolute top-0 start-100 translate-middle badge bg-dark">
        {{ cart_count }}
    </span>
    {% endif %}
</button>

            <a href="/login" class="btn btn-outline-warning">Admin</a>
        </div>
    </div>
</nav>

{% block hero %}{% endblock %}

<div class="container mt-5">
    {% block content %}{% endblock %}
</div>

<footer class="text-center">
    <div class="container">
        <p>Â© 2026 TK Shop. All rights reserved.</p>
    </div>
</footer>

<!-- OVERLAY -->
<div id="cartOverlay"
     onclick="closeCart()"
     style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        backdrop-filter: blur(4px);
        opacity: 0;
        visibility: hidden;
        transition: 0.3s ease;
        z-index: 1000;
     ">
</div>

<!-- CART DRAWER -->
<div id="cartDrawer" style="
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100%;
    background: white;
    box-shadow: -5px 0 20px rgba(0,0,0,0.1);
    transition: 0.3s ease;
    padding: 30px;
    z-index: 1000;
    overflow-y: auto;
">

    <h4>Your Cart</h4>


{% if cart_products %}

    {% for item in cart_products %}

       <div class="d-flex align-items-center mb-3 cart-item"
     id="cart-item-{{ item.product.id }}">

    <!-- PRODUCT IMAGE -->
    <img src="{{ url_for('static', filename=item.product.image) }}"
         style="
            width:70px;
            height:70px;
            object-fit:cover;
            border-radius:10px;
            margin-right:15px;
         ">

    <!-- PRODUCT INFO -->
    <div class="flex-fill">

        <div class="d-flex justify-content-between">

            <strong>{{ item.product.name }}</strong>

            <button type="button"
        class="btn btn-sm remove-btn modern-remove"
        data-id="{{ item.product.id }}">
    <i class="bi bi-trash3"></i>
</button>




    <div class="d-flex align-items-center mt-2">

    <button type="button"
            class="btn btn-sm btn-outline-dark qty-btn"
            data-id="{{ item.product.id }}"
            data-action="decrease">
        -
    </button>

    <span class="mx-2 fw-bold"
          id="qty-{{ item.product.id }}">
        {{ item.quantity }}
    </span>

    <button type="button"
            class="btn btn-sm btn-outline-dark qty-btn"
            data-id="{{ item.product.id }}"
            data-action="increase">
        +
    </button>

</div>



        </div>


<br>

<small style="color:#666;"
        id="subtotal-{{ item.product.id }}">
    ${{ item.subtotal }}
</small>



    </div>

</div>


    {% endfor %}

    <h5>Total: $<span id="cart-total">{{ cart_total }}</span></h5>


        <form action="/checkout" method="POST">
    <button type="submit"
            class="btn btn-acrylic w-100 mt-3 d-flex justify-content-center align-items-center gap-2">

        <i class="bi bi-lock-fill"></i>
        Secure Checkout

    </button>
</form>


    </button>
</form>



{% else %}

    <p>Your cart is empty.</p>

{% endif %}

<button onclick="closeCart()" class="btn btn-outline-dark w-100 mt-4">
    Close
</button>


</div>


<script>
function openCart() {
    document.getElementById("cartDrawer").style.right = "0";
    document.getElementById("cartOverlay").style.opacity = "1";
    document.getElementById("cartOverlay").style.visibility = "visible";
}

function closeCart() {
    document.getElementById("cartDrawer").style.right = "-400px";
    document.getElementById("cartOverlay").style.opacity = "0";
    document.getElementById("cartOverlay").style.visibility = "hidden";
}
</script>



<script>
function removeItem(productId) {

    fetch(`/remove-from-cart/${productId}`, {
        method: "POST"
    })
    .then(response => response.json())
    .then(data => {

        location.reload();

    });
}
</script>


<script>
document.addEventListener("click", function(event) {

    // =========================
    // QUANTITY BUTTONS (+ / -)
    // =========================
    if (event.target.classList.contains("qty-btn")) {

        event.preventDefault();
        event.stopPropagation();

        const productId = event.target.dataset.id;
        const action = event.target.dataset.action;

        fetch("/update-cart/" + productId, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ action: action })
        })
        .then(response => response.json())
        .then(data => {

            const qtyElement = document.getElementById("qty-" + productId);
            const subtotalElement = document.getElementById("subtotal-" + productId);
            const totalElement = document.getElementById("cart-total");
            const checkoutTotal = document.getElementById("checkout-total");

            const badge = document.querySelector(".badge");

            // Update badge
            if (badge) {
                badge.textContent = data.cart_count;
            }

            // Update quantity
            if (qtyElement && data.quantities[String(productId)]) {
                qtyElement.textContent = data.quantities[String(productId)];
            }

            // Remove item if quantity = 0
            if (!data.quantities[String(productId)]) {
                const itemElement = document.getElementById("cart-item-" + productId);
                if (itemElement) {
                    itemElement.remove();
                }
            }

            // Update subtotal
            if (subtotalElement && data.subtotals[String(productId)]) {
                subtotalElement.textContent = "$" + data.subtotals[String(productId)];
            }

            // Update total
            if (totalElement) {
    totalElement.textContent = data.cart_total;
}

if (checkoutTotal) {
    checkoutTotal.textContent = data.cart_total;
}


        });

    }

    // =========================
// REMOVE BUTTON (Trash)
// =========================
const removeButton = event.target.closest(".remove-btn");

if (removeButton) {

    event.preventDefault();
    event.stopPropagation();

    const productId = removeButton.dataset.id;

    fetch("/remove-from-cart/" + productId, {
        method: "POST"
    })
    .then(response => response.json())
    .then(data => {

        const itemElement = document.getElementById("cart-item-" + productId);
        if (itemElement) {
            itemElement.remove();
        }

        const totalElement = document.getElementById("cart-total");
        if (totalElement) {
            totalElement.textContent = data.cart_total;
        }

        const badge = document.querySelector(".badge");
        if (badge) {
            badge.textContent = data.cart_count;
        }

    });

}


});
</script>




</body>
</html>
